{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="{% static 'music/style.css' %}">
    <title>Playing {{ album.title }}</title>
</head>
<body class="landing-page-img">
    <div class="music-player-container">
        <div class="music-player-wrapper">

            <div class="music-player-header">
                <h4>Now Playing - <span>{{ album.title }}</span></h4>
                <i class="fa-solid fa-ellipsis"></i>
            </div>

            <div class="album-cover">
                <div class="album-cover-img-wrapper">
                    <img src="{{ album.album_cover.url }}" alt="">
                    <div class="album-background-overlay"></div>
                    <div class="album-like-dislike">
                        <p>unknown song title</p>
                        <div class="thumbs-up-down">
                            <a class="thumbs-up" href="{% url 'music:like' album.pk %}">
                                <i class="fas fa-thumbs-up"></i>
                                <p>{{ album.thumbs_up }}</p>
                            </a>
                            <a class="thumbs-down" href="{% url 'music:dislike' album.pk %}">
                                <p>{{ album.thumbs_down }}</p>
                                <i class="fas fa-thumbs-down fa-flip-horizontal"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="album-control">
                    <i id="random-btn" class="fas fa-random" title="random"></i>
                    <i id="backward-btn" class="fas fa-backward" title="backward"></i>
                    <div class="album-play-btn" title="play">
                        <i id="play-btn" class="fas fa-play"></i>
                    </div>
                    <i id="forward-btn" class="fas fa-forward" title="forward"></i>
                    <i id="redo-btn" class="fas fa-redo-alt" title="redo"></i>
                </div>
                <div class="progres-bar-container">
                    <p class="initial-time">0:00</p>
                    <progress class="duration-bar" id="progress" value="0"></progress>
                    <p class="end-time">0:00</p>
                </div>
            </div>
        
            <div class="album-side-menu">
                <i class="fa fa-times close-side-menu"></i>
                <p class="song-list-toggle">See Song List</p>
                <p class="close-song-list-toggle">Close Song List</p>
                <a href="{% url 'music:home' %}">Home</a>
                <a href="{% url 'music:all-albums' 'latest albums' %}">Latest Albums</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'music:all-albums' 'recently played'%}">Recently Played</a>
                {% endif %}
            </div>
            <div class="music-player">
                    <div class="song-container">
                        {% if songs %}
                            {% for song in songs %}
                                <audio class="song-file" src="{{ song.song_file.url }}"></audio>
                                <p class="song">
                                  <span id="song">{{ forloop.counter }}.{{ song.title }}</span>
                                </p>
                            {% endfor %}
                        {% else %}
                            <p class="song">
                                <span style="margin-left: 0;">Album does not have any songs!</span> 
                            </p>
                        {% endif %}
                    </div>
                <div class="album-control">
                    <i class="fas fa-random" title="random"></i>
                    <i class="fas fa-backward" title="backward"></i>
                    <div class="album-play-btn" title="play">
                        <i class="fas fa-play"></i>
                    </div>
                    <i class="fas fa-forward" title="forward"></i>
                    <i class="fas fa-redo-alt" title="redo"></i>
                </div>
                <div class="progres-bar-container">
                    <p class="initial-time">0:00</p>
                    <progress class="duration-bar" id="progress" value="0"></progress>
                    <p class="end-time">0:00</p>
                </div>
            </div>
        </div>

        <!-- MOBILE PLAYER -->

        <div class="mobile-player-container">
            <div class="music-player-header">
                <h4>Now Playing - <span>{{ album.title }}</span></h4>
                <i class="fa-solid fa-ellipsis mobile-ellipsis"></i>
            </div>
            <div class="mobile-player-wrapper">
                <img src="{{ album.album_cover.url}}" alt="">

                <div class="album-background-overlay"></div>
                <div class="album-like-dislike">
                    <p>unknown song title</p>
                    <div class="thumbs-up-down">
                        <a class="thumbs-up" href="{% url 'music:like' album.pk %}">
                            <i class="fas fa-thumbs-up"></i>
                            <p>{{ album.thumbs_up }}</p>
                        </a>
                        <a class="thumbs-down" href="{% url 'music:dislike' album.pk %}">
                            <p>{{ album.thumbs_down }}</p>
                            <i class="fas fa-thumbs-down fa-flip-horizontal"></i>
                        </a>
                    </div>
                </div>

            </div>
            <div id="mobile-song-container" class="song-container">
                {% if album.song_set.all %}
                    {% for song in album.song_set.all %}
                        <audio class="song-file" src="{{ song.song_file.url }}"></audio>
                        <p class="song-title">
                           {{ forloop.counter}} .<span>{{ song.title }}</span>
                        </p>
                    {% endfor%}
                {% else %}
                    <p class="song-title">
                        <span style="margin-left: 0">Album does not have any songs!</span> 
                    </p>
                {% endif %}
            </div>
            <div class="album-control">
                <i class="fas fa-random" title="random"></i>
                <i class="fas fa-backward" title="backward"></i>
                <div class="album-play-btn" title="play">
                    <i class="fas fa-play"></i>
                </div>
                <i class="fas fa-forward" title="forward"></i>
                <i class="fas fa-redo-alt" title="redo"></i>
            </div>
            <div class="progres-bar-container">
                <p class="initial-time">0:00</p>
                <progress class="duration-bar" id="progress" value="0"></progress>
                <p class="end-time">0:00</p>
            </div>

            <!-- SIDE MENU -->

            <div class="mobile-side-menu">
                <i class="fa fa-times close-mobile-side-menu"></i>
                <p id="mobile-song-list" class="mobile-song-list-toggle">See Song List</p>
                <p id="mobile-close-song-list" class="mobile-close-song-list-toggle">Close Song List</p>
                <a href="{% url 'music:home' %}">Home</a>
                <a href="{% url 'music:all-albums' 'latest albums' %}">Latest Albums</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'music:all-albums' 'recently played'%}">Recently Played</a>
                {% endif %}
            </div>

            <!-- END SIDE MENU -->

        </div>

        <!-- MOBILE PLAYER END -->
    </div>

    <script type="text/javascript">
        const musicPlayerWrapper = document.querySelector(".music-player-wrapper")
        const ellipsis = document.querySelector(".fa-ellipsis")
        const musicplayer = document.querySelector(".music-player")
        const albumCover = document.querySelector(".album-cover")
        const times = document.querySelector(".fa-times")
        const musicPlayerHeader = document.querySelector(".music-player-header")
        const body = document.querySelector("body")
        const albumSideMenu = document.querySelector(".album-side-menu")
        const closeSideMenu = document.querySelector(".close-side-menu")
        const songListToggle = document.querySelector(".song-list-toggle")
        const closeSongListToggle = document.querySelector(".close-song-list-toggle")
        let songList = document.querySelectorAll(".song")
        const songs = [...songList]
        // const idSongs = document.querySelectorAll("#song")
        const albumLikeDislike = document.querySelector(".album-like-dislike")

    
        let songTitle = musicplayer.firstElementChild.lastElementChild.firstElementChild.textContent
        albumLikeDislike.firstElementChild.textContent = songTitle

        window.addEventListener("resize", ()=>{
            if(window.innerWidth > 500){
                albumLikeDislike.firstElementChild.textContent = songTitle
            }
        })

        songs.forEach(function(item){
            item.addEventListener("click", ()=>{
                musicplayer.classList.toggle("show-music-player")
                albumCover.classList.toggle("hide-album-cover")
                albumLikeDislike.firstElementChild.textContent = item.firstElementChild.textContent
                songTitle = item.firstElementChild.textContent
                songListToggle.style.display = "block"
                closeSongListToggle.style.display = "none"

                const songFile = document.querySelectorAll(".song-file")
                let titleIndex = songs.indexOf(item)
                songFile[titleIndex].load()
                songFile[titleIndex].play()
            })
        })

        ellipsis.addEventListener("click", function(){
            albumSideMenu.classList.toggle("show-side-menu")
            closeSideMenu.style.visibility = "visible"
        })

        closeSideMenu.addEventListener("click", ()=>{
            albumSideMenu.classList.toggle("show-side-menu")
            closeSideMenu.style.visibility = "hidden"
        })

        songListToggle.addEventListener("click", ()=> {
            musicplayer.classList.toggle("show-music-player")
            albumCover.classList.toggle("hide-album-cover")
            body.style.overflow = "hidden"
            albumSideMenu.classList.toggle("show-side-menu")
            songListToggle.style.display = "none"
            closeSongListToggle.style.display = "block" 
        })

        closeSongListToggle.addEventListener("click", function(){
            musicplayer.classList.toggle("show-music-player")
            albumCover.classList.toggle("hide-album-cover")
            body.style.overflow = "hidden"
            albumSideMenu.classList.toggle("show-side-menu")
            songListToggle.style.display = "block"
            closeSongListToggle.style.display = "none" 
        })


        // MOBILE PLAYER
        const mobileEllipsis = document.querySelector(".mobile-ellipsis")
        const mobileSideMenu = document.querySelector(".mobile-side-menu")
        const closeMobileSideMenu = document.querySelector(".close-mobile-side-menu")
        const mobileSongListToggle = document.querySelector(".mobile-song-list-toggle")
        const mobileCloseSongListToggle = document.querySelector(".mobile-close-song-list-toggle")
        const mobileSongContainer = document.querySelector("#mobile-song-container")
        const mobileSongList = document.querySelector("#mobile-song-list")
        const mobileCloseSongList = document.querySelector("#mobile-close-song-list")
        const mobilePlayerWrapper = document.querySelector(".mobile-player-wrapper")
        const mobileSongs = document.querySelectorAll(".song-title")

        let mobileSongTitle = mobileSongContainer.lastElementChild.firstElementChild.textContent
        mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = mobileSongTitle

       

        mobileSongs.forEach(function(item){
            item.addEventListener("click", ()=>{
                mobileSongContainer.classList.toggle("show-mobile-song-container")
                mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = item.firstElementChild.textContent
                songTitle = item.firstElementChild.textContent
                mobileSongListToggle.style.display = "block"
                mobileCloseSongListToggle.style.display = "none"
            })
        })

        window.addEventListener("resize", ()=>{
            if(window.innerWidth < 500){
                mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = songTitle
                let mobileSongTitle = mobileSongContainer.firstElementChild.firstElementChild.textContent
                songTitle = mobileSongTitle
            }
           
        })

        mobileEllipsis.addEventListener("click", ()=>{
            mobileSideMenu.classList.toggle("show-side-menu")
            closeMobileSideMenu.style.visibility = "visible"
        })

        closeMobileSideMenu.addEventListener("click", function(){
            mobileSideMenu.classList.toggle("show-side-menu")
            closeMobileSideMenu.style.visibility = "hidden"
        })

        mobileSongListToggle.addEventListener("click", ()=>{
            mobileSongContainer.classList.toggle("show-mobile-song-container")
            mobileSideMenu.classList.toggle("show-side-menu")
            mobileSongList.style.display = "none"
            mobileCloseSongList.style.display = "block"

        })
        mobileCloseSongListToggle.addEventListener("click", ()=>{
            mobileSongContainer.classList.toggle("show-mobile-song-container")
            mobileSideMenu.classList.toggle("show-side-menu")
            mobileSongList.style.display = "block"
            mobileCloseSongList.style.display = "none"

        })

        // END MOBILE PLAYER
    </script>
</body>
</html>

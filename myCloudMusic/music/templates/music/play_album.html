{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="{% static 'music/style.css' %}">
    <title>Playing {{ album.title }}</title>
</head>
<body class="landing-page-img">
    <div class="music-player-container">
        <div class="music-player-wrapper">

            <div class="music-player-header">
                <h4>Now Playing - <span>{{ album.title }}</span></h4>
                <i class="fa-solid fa-ellipsis"></i>
            </div>

            <div class="album-cover">
                <div class="album-cover-img-wrapper">
                    <img src="{{ album.album_cover.url }}" alt="">
                    <div class="album-background-overlay"></div>
                    <div class="album-like-dislike">
                        <p>unknown song title</p>
                        <div class="thumbs-up-down">
                            <a class="thumbs-up" href="{% url 'music:like' album.pk %}">
                                <i class="fas fa-thumbs-up"></i>
                                <p>{{ album.thumbs_up }}</p>
                            </a>
                            <a class="thumbs-down" href="{% url 'music:dislike' album.pk %}">
                                <p>{{ album.thumbs_down }}</p>
                                <i class="fas fa-thumbs-down fa-flip-horizontal"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="album-control">
                    <i id="random-btn" class="fas fa-random random" title="random"></i>
                    <i id="backward-btn" class="fas fa-backward backward" title="backward"></i>
                    <div class="album-play-btn" title="play">
                        <i id="play-btn" class="fas fa-play play"></i>
                        <i id="pause-btn" class="fas fa-pause pause"></i>
                    </div>
                    <i id="forward-btn" class="fas fa-forward forward" title="forward"></i>
                    <i id="redo-btn" class="fas fa-redo-alt redo" title="redo"></i>
                </div>
                <div class="progres-bar-container">
                    <p class="initial-time">0:00</p>
                    <progress class="duration-bar" id="progress" value="0"></progress>
                    <p class="end-time">0:00</p>
                </div>
            </div>
        
            <div class="album-side-menu">
                <i class="fa fa-times close-side-menu"></i>
                <p class="song-list-toggle">See Song List</p>
                <p class="close-song-list-toggle">Close Song List</p>
                <a href="{% url 'music:home' %}">Home</a>
                <a href="{% url 'music:all-albums' 'latest albums' %}">Latest Albums</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'music:all-albums' 'recently played'%}">Recently Played</a>
                {% endif %}
            </div>
            <div class="music-player">
                {% if songs %}
                    <div class="song-container">
                        <div>
                            {% for song in songs %}
                                <audio class="song-file" src="{{ song.song_file.url }}"></audio>
                            {% endfor %}
                        </div>
                        
                        <div>
                            {% for song in songs %}
                            <p class="song">
                                {{ forloop.counter }} .<span id="song"> {{ song.title }}</span>
                            </p>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                <div class="song-container">
                    <p class="song">
                        <span style="margin-left: 0;">Album does not have any songs!</span>
                    </p>
                </div>
                {% endif %}

                <div class="album-control" style="position: relative;">
                    <i id="random-btn" class="fas fa-random random" title="random"></i>
                    <i id="backward-btn" class="fas fa-backward backward" title="backward"></i>
                    <div class="album-play-btn" title="play">
                        <i id="play-btn" class="fas fa-play play" style="position: relative;">
                            <i class="fa fa-ban play" style="position: absolute;top:50%;left: 50%;width: 100;height:100;
                            transform: translate(-50%, -50%); color: red; font-size: 1.7rem;"></i>
                        </i>
                        <!-- <i id="pause-btn" class="fas fa-pause pause"></i> -->
                        <!-- <i class="fa fa-ban play"></i> -->
                    </div>
                    <i id="forward-btn" class="fas fa-forward forward" title="forward"></i>
                    <i id="redo-btn" class="fas fa-redo-alt redo" title="redo"></i>
                    <div class="album-background-overlay" style="background: rgba(0, 0, 0, 0.5)"></div>
                </div>
                <div class="progres-bar-container" style="position: relative;">
                    <p class="initial-time">0:00</p>
                    <progress class="duration-bar" id="progress" value="0"></progress>
                    <p class="end-time">0:00</p>
                    <div class="album-background-overlay" style="border-bottom-left-radius: 15px;border-bottom-right-radius: 15px;
                    background: rgba(0, 0, 0, 0.5)"></div>
                </div>
            </div>
        </div>

        <!-- MOBILE PLAYER -->

        <div class="mobile-player-container">
            <div class="music-player-header">
                <h4>Now Playing - <span>{{ album.title }}</span></h4>
                <i class="fa-solid fa-ellipsis mobile-ellipsis"></i>
            </div>
            <div class="mobile-player-wrapper">
                <img src="{{ album.album_cover.url}}" alt="">

                <div class="album-background-overlay"></div>
                <div class="album-like-dislike">
                    <p>unknown song title</p>
                    <div class="thumbs-up-down">
                        <a class="thumbs-up" href="{% url 'music:like' album.pk %}">
                            <i class="fas fa-thumbs-up"></i>
                            <p>{{ album.thumbs_up }}</p>
                        </a>
                        <a class="thumbs-down" href="{% url 'music:dislike' album.pk %}">
                            <p>{{ album.thumbs_down }}</p>
                            <i class="fas fa-thumbs-down fa-flip-horizontal"></i>
                        </a>
                    </div>
                </div>

            </div>
            <div id="mobile-song-container" class="song-container">
                {% if album.song_set.all %}
                    <div class="mobile-songs">
                        <div>
                            {% for song in album.song_set.all %}
                                <audio class="mobile-song-file" src="{{ song.song_file.url }}"></audio>
                            {% endfor%}
                        </div>
                        <div>
                            {% for song in album.song_set.all %}
                                <p class="mobile-song-title">
                                    {{ forloop.counter}}. <span>{{ song.title }}</span>
                                </p>
                            {% endfor %}
                        </div>
                    </div>
                {% else %}
                    <p class="mobile-song-title">
                        <span style="margin-left: 0">Album does not have any songs!</span> 
                    </p>
                {% endif %}
            </div>
            <div class="album-control">
                <i class="fas fa-random mobile-random" title="random"></i>
                <i class="fas fa-backward mobile-backward" title="backward"></i>
                <div class="album-play-btn" title="play">
                    <i id="play-btn" class="fas fa-play mobile-play"></i>
                    <i id="pause-btn" class="fas fa-pause mobile-pause"></i>
                </div>
                <i class="fas fa-forward mobile-forward" title="forward"></i>
                <i class="fas fa-redo-alt mobile-redo" title="redo"></i>
            </div>
            <div class="progres-bar-container">
                <p class="initial-time">0:00</p>
                <progress class="duration-bar" id="progress" value="0"></progress>
                <p class="end-time">0:00</p>
            </div>

            <!-- SIDE MENU -->

            <div class="mobile-side-menu">
                <i class="fa fa-times close-mobile-side-menu"></i>
                <p id="mobile-song-list" class="mobile-song-list-toggle">See Song List</p>
                <p id="mobile-close-song-list" class="mobile-close-song-list-toggle">Close Song List</p>
                <a href="{% url 'music:home' %}">Home</a>
                <a href="{% url 'music:all-albums' 'latest albums' %}">Latest Albums</a>
                {% if user.is_authenticated %}
                    <a href="{% url 'music:all-albums' 'recently played'%}">Recently Played</a>
                {% endif %}
            </div>

            <!-- END SIDE MENU -->

        </div>

        <!-- MOBILE PLAYER END -->
    </div>

    <script type="text/javascript">
        const musicPlayerWrapper = document.querySelector(".music-player-wrapper")
        const ellipsis = document.querySelector(".fa-ellipsis")
        const musicplayer = document.querySelector(".music-player")
        const albumCover = document.querySelector(".album-cover")
        const times = document.querySelector(".fa-times")
        const musicPlayerHeader = document.querySelector(".music-player-header")
        const body = document.querySelector("body")
        const albumSideMenu = document.querySelector(".album-side-menu")
        const closeSideMenu = document.querySelector(".close-side-menu")
        const songListToggle = document.querySelector(".song-list-toggle")
        const closeSongListToggle = document.querySelector(".close-song-list-toggle")
        let songList = document.querySelectorAll(".song")
        const songs = [...songList]
        const albumLikeDislike = document.querySelector(".album-like-dislike")
        let songFiles = document.querySelectorAll(".song-file")

        // ALBUM CONTROL
        const pauseBtn = document.querySelector("#pause-btn")
        const playBtn = document.querySelector("#play-btn")
        const forward = document.querySelector(".forward")
        const backward = document.querySelector(".backward")
        const play = document.querySelector(".play")
        const pause = document.querySelector(".pause")
        const random = document.querySelector(".random")
        const redo = document.querySelector(".redo")

        let index = 0
        let current_song_title = songs[index].firstElementChild.textContent
        
        // LARGE SCREEN

        // let songTitle = musicplayer.firstElementChild.lastElementChild.firstElementChild.firstElementChild.textContent
        albumLikeDislike.firstElementChild.textContent = current_song_title

        window.addEventListener("resize", ()=>{
            if(window.innerWidth > 500){
                // albumLikeDislike.firstElementChild.textContent = songTitle
                albumLikeDislike.firstElementChild.textContent = current_song_title
            }
        })

        songs.forEach(function(item){
            item.addEventListener("click", ()=>{
                songFiles[index].pause()
                musicplayer.classList.toggle("show-music-player")
                albumCover.classList.toggle("hide-album-cover")
                albumLikeDislike.firstElementChild.textContent = item.firstElementChild.textContent
                current_song_title = item.firstElementChild.textContent
                // songTitle = item.firstElementChild.textContent
                songListToggle.style.display = "block"
                closeSongListToggle.style.display = "none"

                // click on a song to play
                index = songs.indexOf(item)
                songFiles[index].load()
                songFiles[index].play()
                playBtn.style.display = 'none'
                pauseBtn.style.display = 'block'
            })
        })

        ellipsis.addEventListener("click", function(){
            albumSideMenu.classList.toggle("show-side-menu")
            closeSideMenu.style.visibility = "visible"
        })

        closeSideMenu.addEventListener("click", ()=>{
            albumSideMenu.classList.toggle("show-side-menu")
            closeSideMenu.style.visibility = "hidden"
        })

        songListToggle.addEventListener("click", ()=> {
            musicplayer.classList.toggle("show-music-player")
            albumCover.classList.toggle("hide-album-cover")
            body.style.overflow = "hidden"
            albumSideMenu.classList.toggle("show-side-menu")
            songListToggle.style.display = "none"
            closeSongListToggle.style.display = "block" 
        })

        closeSongListToggle.addEventListener("click", function(){
            musicplayer.classList.toggle("show-music-player")
            albumCover.classList.toggle("hide-album-cover")
            body.style.overflow = "hidden"
            albumSideMenu.classList.toggle("show-side-menu")
            songListToggle.style.display = "block"
            closeSongListToggle.style.display = "none" 
        })

        // large screen player
        play.addEventListener("click", ()=>{
            songFiles[index].play()
            playBtn.style.display = 'none'
            pauseBtn.style.display = 'block'
        })

        pause.addEventListener("click", ()=>{
            songFiles[index].pause()
            playBtn.style.display = 'block'
            pauseBtn.style.display = 'none'
        })

        // END OF LARGE SCREEN

        // MOBILE PLAYER
        const mobileEllipsis = document.querySelector(".mobile-ellipsis")
        const mobileSideMenu = document.querySelector(".mobile-side-menu")
        const closeMobileSideMenu = document.querySelector(".close-mobile-side-menu")
        const mobileSongListToggle = document.querySelector(".mobile-song-list-toggle")
        const mobileCloseSongListToggle = document.querySelector(".mobile-close-song-list-toggle")
        const mobileSongContainer = document.querySelector("#mobile-song-container")
        const mobileSongList = document.querySelector("#mobile-song-list")
        const mobileCloseSongList = document.querySelector("#mobile-close-song-list")
        const mobilePlayerWrapper = document.querySelector(".mobile-player-wrapper")
        const mobileSongs = document.querySelectorAll(".song-title")

        // let mobileSongTitle = mobileSongContainer.firstElementChild.lastElementChild.firstElementChild.firstElementChild.textContent
        // mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = mobileSongTitle

        mobileSongs.forEach(function(item){
            item.addEventListener("click", ()=>{
                mobileSongContainer.classList.toggle("show-mobile-song-container")
                mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = item.firstElementChild.textContent
                songTitle = item.firstElementChild.textContent
                mobileSongListToggle.style.display = "block"
                mobileCloseSongListToggle.style.display = "none"
            })
        })

        window.addEventListener("resize", ()=>{
            if(window.innerWidth < 500){
                mobilePlayerWrapper.lastElementChild.firstElementChild.textContent = current_song_title
                // let mobileSongTitle = mobileSongContainer.firstElementChild.firstElementChild.textContent
                // songTitle = mobileSongTitle
            }
           
        })

        mobileEllipsis.addEventListener("click", ()=>{
            mobileSideMenu.classList.toggle("show-side-menu")
            closeMobileSideMenu.style.visibility = "visible"
        })

        closeMobileSideMenu.addEventListener("click", function(){
            mobileSideMenu.classList.toggle("show-side-menu")
            closeMobileSideMenu.style.visibility = "hidden"
        })

        mobileSongListToggle.addEventListener("click", ()=>{
            mobileSongContainer.classList.toggle("show-mobile-song-container")
            mobileSideMenu.classList.toggle("show-side-menu")
            mobileSongList.style.display = "none"
            mobileCloseSongList.style.display = "block"

        })
        mobileCloseSongListToggle.addEventListener("click", ()=>{
            mobileSongContainer.classList.toggle("show-mobile-song-container")
            mobileSideMenu.classList.toggle("show-side-menu")
            mobileSongList.style.display = "block"
            mobileCloseSongList.style.display = "none"

        })

         // mobile screen
        const mobile_song_titles = document.querySelectorAll(".mobile-song-title")
        const mobile_song_files = document.querySelectorAll(".mobile-song-file")
        const mobile_forward = document.querySelector(".mobile-forward")
        const mobile_backward = document.querySelector(".mobile-backward")
        const mobile_play = document.querySelector(".mobile-play")
        const mobile_pause = document.querySelector(".mobile-pause")
        const mobile_random = document.querySelector(".mobile-random")
        const mobile_redo = document.querySelector(".mobile-redo")

        mobile_play.addEventListener("click", ()=>{
            current_song_title = mobile_song_titles[index].firstElementChild.textContent
            pauseBtn.style.display = "block"
            playBtn.style.display = "none"
            mobile_song_files[index].play()
        })
        // END MOBILE PLAYER
   
    </script>
</body>
</html>
